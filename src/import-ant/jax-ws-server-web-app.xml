<!--
    ImportAnt
    Copyright (C) 2004-2009  Miguel Filipe Leitao Pardal

    This library is free software; you can redistribute it and/or
    modify it under the terms of the GNU Lesser General Public
    License as published by the Free Software Foundation; either
    version 2.1 of the License, or any later version.

    This library is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
    Lesser General Public License for more details.

    You should have received a copy of the GNU Lesser General Public
    License along with this library; if not, write to the Free Software
    Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA

    Contact the authors at: miguel.pardal@ist.utl.pt
-->
<project name="jax-ws-server-web-app">
    <fail message="MUST INCLUDE core BEFORE jax-ws-server" unless="import-ant.module.core" />
    <fail message="MUST INCLUDE A web-app-env BEFORE jax-ws-server" unless="import-ant.module.web-app-env" />
    <fail message="MUST INCLUDE A jax-ws-env BEFORE jax-ws-server" unless="import-ant.module.jax-ws-env" />

    <!--
        This module allows the creation of dual interface web applications: web app + web service.
        Place the merged web.xml file in the config/web dir and not in the config/jax-ws-server.
    -->

    <!--            -->
    <!-- PROPERTIES -->
    <!--            -->
    <property name="import-ant.module.jax-ws-server-web-app" value="true" />


    <!--         -->
    <!-- TARGETS -->
    <!--         -->

    <!-- PUBLIC AUXILIARY TARGETS (name, no description) -->
    <target name="create-web-ws-war">
        <!-- prepare libraries -->
        <antcall target="-build-libs" />
        <!-- copy additional configuration files to build classes -->
        <copy todir="${build.classes.rel-dir}" overwrite="true">
            <fileset dir="${build.config.web-app.rel-dir}"
                     includes="**/*"
                     excludes="web.xml"/>
        </copy>
        <!-- create new war, deleting previous version first -->
        <delete file="${web-app-env.deploy.war.rel-file}" />
        <jar destfile="${web-app-env.deploy.war.rel-file}">
            <zipfileset dir="${build.config.web-app.rel-dir}"
                        includes="web.xml"
                        prefix="WEB-INF" />
            <zipfileset dir="${build.config.jax-ws-server.rel-dir}"
                        prefix="WEB-INF"
                        includes="sun-jaxws.xml, ${jax-ws-server.security.config.file-pattern}" />
            <zipfileset dir="${build.jax.rel-dir}"
                        prefix="WEB-INF/wsdl"
                        includes="*.wsdl, *.xsd" />
            <zipfileset dir="${src.web.rel-dir}" />
            <zipfileset dir="${build.classes.rel-dir}"
                        prefix="WEB-INF/classes" />
            <zipfileset dir="${build.lib.rel-dir}"
                        prefix="WEB-INF/lib" />
        </jar>
        <!-- delete lib copies immediately to save space -->
        <antcall target="-clean-libs" />
    </target>

</project>
